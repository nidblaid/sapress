<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="contract_search_filter" model="ir.ui.view">
        <field name="name">sochepress.contract.search</field>
        <field name="model">sochepress.contract</field>
        <field name="arch" type="xml">
            <search string="Contracts">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="reference"/>
                <field name="stage_id"/>
                <!--                <field name="price_list_id"/>-->

                <filter name="to_renew" string="To renew"
                        domain="[('to_renew', '=', True)]"/>
                <group string="Group by">
                    <filter name="customer" string="Customer"
                            context="{'group_by':'partner_id'}"/>
                    <!--                    <filter name="price_list_id" string="Price List"-->
                    <!--                            context="{'group_by':'price_list_id'}"/>-->
                    <!--                    <filter name="facturation_mode" string="Invoicing mode" context="{'group_by':'facturation_mode'}"/>-->
                </group>
            </search>
        </field>
    </record>

    <record id="sochepress_contract_form_view" model="ir.ui.view">
        <field name="name">sochepress.contract.form</field>
        <field name="model">sochepress.contract</field>
        <field name="arch" type="xml">
            <form string="Requests">
                <header>
                    <button name="compute_max" string="Recalculer les max" type="object" invisible="1"/>
                    <field name="stage_id" widget="statusbar"
                           options="{'clickable': '1'}"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" icon="fa-dollar" name="see_invoices" type="object">
                            <field name="invoice_count" widget="statinfo" string="Invoices"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-book" name="see_demandes" type="object">
                            <field name="demande_count" widget="statinfo" string="Demandes"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-exchange" name="see_expeditions" type="object">
                            <field name="expeditions_count" widget="statinfo" string="Expeditions"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-cubes" name="see_colis" type="object">
                            <field name="colis_count" widget="statinfo" string="Colis"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="partner_id" required="1"/>
                            <label for="start_date" string="Duration"/>
                            <div class="o_row">
                                <field name="start_date" widget="daterange" required="1"
                                       options='{"related_end_date": "end_date"}'/>
                                <span class="fa fa-arrow-right"/>
                                <field name="end_date" widget="daterange" required="1"
                                       options='{"related_start_date": "start_date"}'/>

                            </div>
                            <!--                            <field name="start_date" required="1"/>-->
                            <!--                            <field name="destination_ids" widget="many2many_tags"-->
                            <!--                                   options="{'no_create': True}"-->
                            <!--                                   readonly="1"-->
                            <!--                                   attrs="{'invisible': [('destination_ids','=',False)]}"-->
                            <!--                                   force_save="1"/>-->
                            <!--                            <field name="max_weight" force_save="1"/>-->
                            <!--                            <field name="max_volume" force_save="1"/>-->
                            <!--                            <field name="to_renew" widget="boolean_toggle"/>-->
                            <!--                            <field name="documentary_return"/>-->
                        </group>
                        <group>
                            <!--                            <field name="facturation_mode"/> attrs="{'invisible': [('facturation_mode','=','forfait')]}" -->
                            <!--                            <field name="fix_price" attrs="{'invisible': [('facturation_mode','=','tarif')]}"/>-->
                            <!--                            <field name="price_list_id" required="1"/>-->
                            <!--                            <field name="tarification_grill_id" />-->
                            <!--                            <field name="product_id" attrs="{'required': [('tarification_grill_id','!=',False)], 'invisible': [('tarification_grill_id','=',False)]}"/>-->
                            <!--                            <field name="end_date" required="1"/>-->
                            <field name="reference"/>
                            <!--                            <field name="insurance_rate"/>-->
                            <!--                            <label for="cod_percent"/>-->
                            <!--                            <div class="o_row" name="cod_percent">-->
                            <!--                                <field name="cod_percent" nolabel="1"/>-->
                            <!--                                <span>%</span>-->
                            <!--                            </div>-->
                            <!--                            <field name="max_amount"/>-->
                            <!--                            <field name="min_amount"/>-->
                            <!--                            <field name="pod_amount"/>-->
                        </group>
                    </group>

                    <notebook>
                        <page string="Returns">
                            <group>
                                <group>
                                    <field name="type_policy"/>
                                    <field name="output_nom" invisible="1"/>
                                    <field name="policy_file" filename="output_nom"
                                           attrs="{'invisible': [('type_policy','!=','file')]}"/>
                                </group>
                                <group>
                                    <label for="retun_rate"/>
                                    <div class="o_row" name="retun_rate">
                                        <field name="retun_rate"/>
                                        <span>
                                            %
                                        </span>
                                    </div>
                                    <field name="acceptation_delay"/>
                                </group>
                            </group>
                            <group>
                                <field name="return_policy" widget="html"
                                       attrs="{'invisible': [('type_policy','!=','text')]}"/>
                            </group>
                        </page>
                    </notebook>

                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="contract_tree_view_tt" model="ir.ui.view">
        <field name="name">sochepress.contract.tree</field>
        <field name="model">sochepress.contract</field>
        <field name="arch" type="xml">
            <tree default_order="create_date desc">
                <field name="name"/>
                <field name="partner_id" optional="hide"/>
                <field name="start_date"/>
                <field name="create_date" invisible="1"/>
                <field name="end_date"/>
                <!--                <field name="price_list_id"/>-->
                <!--                <field name="services_ids" widget="many2many_tags"/>-->

                <!--                <field name="facturation_mode"/>-->
                <field name="stage_id"/>
            </tree>
        </field>
    </record>

    <record id="ccontract_pivot_view_tt" model="ir.ui.view">
        <field name="name">sochepress.contract.tree</field>
        <field name="model">sochepress.contract</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" class="o_kanban_mobile">
                <field name="user_id"/>
                <field name="stage_id"
                       options="{'group_by_tooltip': {'description': 'Description'}}"/>
                <field name="activity_ids"/>
                <field name="to_renew"/>
                <field name="activity_state"/>
                <progressbar field="activity_state"
                             colors="{&quot;planned&quot;: &quot;success&quot;, &quot;today&quot;: &quot;warning&quot;, &quot;overdue&quot;: &quot;danger&quot;}"
                             help="This bar allows to filter the opportunities based on scheduled activities."/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div>
                                    <strong>
                                        <!--                                        <div class="float-right">-->
                                        <!--                                            <field name="recurring_total" widget="monetary"/>-->
                                        <!--                                        </div>-->
                                        <field name="partner_id"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div t-if="record.to_renew.raw_value"
                                         class="badge badge-warning border-0 float-right mt4">
                                        To Renew
                                    </div>
                                    <field name="code"/>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="activity_ids"
                                               widget="kanban_activity"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <img
                                            t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)"
                                            t-att-title="record.user_id.value"
                                            t-att-alt="record.user_id.value"
                                            class="oe_kanban_avatar"/>
                                    </div>
                                </div>
                            </div>
                            <div class="oe_clear"/>
                        </div>
                    </t>
                </templates>
            </kanban>

        </field>
    </record>

    <record model="ir.actions.act_window" id="contract_action">
        <field name="name">Contracts</field>
        <field name="res_model">sochepress.contract</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="sochepress_base.contract_search_filter"/>
    </record>

</odoo>
