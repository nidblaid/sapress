<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <record id="ordre_transport_trajet_wizard_view_form" model="ir.ui.view">
            <field name="name">moving.wizard.form</field>
            <field name="model">moving.wizard</field>
            <field name="arch" type="xml">
                <form string="Slide">
                    <div class="oe_title">
                    </div>
                    <group>
                        <p>
                            <field name="message" readonly="1"/>
                        </p>
                    </group>
                    <group>
                        <field name="commentaire_id" options="{'no_create': True, 'no_edit': True}" required="1"/>
                    </group>
                    <footer>
                        <button string="Move forward" type="object" class="btn-primary"
                                name="valider"/>
                        <button string="Cancel" class="btn btn-secondary"
                                special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>


        <record model="ir.actions.act_window" id="transport_order_trajet_wizard_action">
            <field name="name">moving.wizard</field>
            <field name="res_model">moving.wizard</field>
            <field name="target">new</field>
            <field name="view_mode">form</field>
        </record>


        <record id="sochepress_2_form_view" model="ir.ui.view">
            <field name="name">soch.transport.order.form</field>
            <field name="model">soch.transport.order</field>
            <field name="arch" type="xml">
                <form string="Requests">
                    <header>
                        <field name="hide_forward" invisible="1"/>
                        <field name="finished" invisible="1"/>
                        <field name="first_step" invisible="1"/>
                        <field name="hide_backward" invisible="1"/>
                        <field name="reported_colis" invisible="1"/>
                        <field name="show_finalize" invisible="1"/>
                        <!--<button string="Forward" type="action" class="oe_highlight"-->
                        <!--context="{'order_id': active_id}"-->
                        <!--name="%(transport_order_trajet_wizard_action)d"-->
                        <!--attrs="{'invisible': [('hide_forward', '=', True)]}"/>-->

                        <button string="Forward" type="object" class="oe_highlight"
                                context="{'order_id': active_id, 'source': 'interface'}"
                                name="next_position"
                                attrs="{'invisible': ['|', ('hide_forward', '=', True), ('finished', '=', True)]}"/>
                        <button string="Backward" type="object" class="oe_highlight"
                                context="{'order_id': active_id, 'source': 'interface'}"
                                name="previous_position"
                                attrs="{'invisible': ['|', ('hide_backward','=',True), ('finished', '=', True)]}"
                        />
                        <button string="Finaliser" type="object" class="oe_highlight"
                                context="{'order_id': active_id}"
                                name="close"
                                attrs="{'invisible': [('show_finalize', '=', False)]}"/>

                        <field name="current_position_id" widget="statusbar"
                               domain="[('order_id', '=',active_id )]"/>
                        <button name="print_all" string="Print" type="object"
                                class="oe_highlight"/>
                        <button name="print_all_return" string="BL de retours" type="object"
                                class="oe_highlight"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="see_colis" type="object"
                                    class="oe_stat_button"
                                    icon="fa-list">
                                <field name="nbre_colis" widget="statinfo"/>
                            </button>
                            <button string="Tracking"
                                    type="object"
                                    name="action_view_tracking"
                                    class="oe_stat_button"
                                    icon="fa-arrows-v"
                            />
                        </div>

                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="source_id" required="1" options="{'no_create': True, 'no_open': 'True'}"/>
                                <field name="transport_type" required="1"/>
                                <field name="primaire" attrs="{'invisible': [('transport_type','!=','intern')]}"/>
                                <field name="type_ot"/>
                            </group>
                            <group>
                                <field name="destination_id" required="1"
                                       options="{'no_create': True, 'no_open': 'True'}"/>
                                <field name="ot_state" readonly="1"/>
                                <field name="date"/>


                            </group>
                        </group>
                        <group string="Trajet">
                            <field name="traject_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="destination_id" required="1"
                                           options="{'no_create': True, 'no_open': 'True'}"/>
                                </tree>
                            </field>
                        </group>
                        <!--                        <group string="Locations">-->
                        <!--                            <field name="locations_ids" nolabel="1">-->
                        <!--                            </field>-->
                        <!--                        </group>-->
                        <group string="Colis">

                            <field name="colis" widget="many2many" nolabel="1"
                                   context="{ 'default_source_id': source_id,  'default_destination_id': destination_id, }"
                                   domain="['|',('retract', '=', 'yes'),'&amp;',('request_state', '=', 'accepted')
                                   ,'|','|','&amp;',('step', '=', 'new'),('order_id','=',False),'&amp;',
                                   ('step', '=', 'discharged'),'|',('order_id','=',False),('order_id.ot_state','=','finalized'),('step', '=', 'not_pickup')]">
                                <tree>
                                    <field name="charged" invisible="1"/>
                                    <field name="discharged" invisible="1"/>
                                    <field name="is_refused" invisible="1"/>
                                    <field name="retract" invisible="1"/>
                                    <field name="name"/>
                                    <field name="type_colis_id"/>
                                    <field name="source_id"/>
                                    <field name="destination_id"/>
                                    <field name="state_colis_id"/>
                                    <field name="weight"/>
                                    <field name="volume"/>
                                    <field name="step"/>
                                    <field name="return_state"/>
                                    <field name="return_method_id" options="{'no_create': True, 'no_edit': True}"/>
                                    <field name="return_amount"
                                           attrs="{'required': [('return_method_id', '!=', False)]}"/>
                                    <field name="a_livrer" invisible="1"/>
                                    <button name="charger2"
                                            type="object"
                                            class="fa fa-plus"
                                            attrs="{'invisible':
                                            ['|',('step', 'not in', ['new', 'discharged', 'not_pickup', 'retracted']),
                                            '|',('a_livrer', '=', True), ('parent.finished', '=', True)
                                            ]}"
                                    />
                                    <button name="decharger"
                                            type="object"
                                            class="fa fa-times"
                                            attrs="{'invisible': ['|',('step', 'not in', ['charged','reported', 'refused', 'non_delivered']),'|',('a_livrer', '=', True),('parent.finished', '=', True)]}"
                                    />

                                    <button name="report2"
                                            type="object"
                                            class="fa fa-arrow-left"
                                            attrs="{'invisible': ['|',('a_livrer', '=', False),('is_refused','=',True)]}"
                                    />

                                    <button name="livrer"
                                            type="object"
                                            class="fa fa-truck"
                                            attrs="{'invisible': ['|',('a_livrer', '=', False)]}"
                                    />

                                    <button name="refuse"
                                            type="object"
                                            class="fa fa-ban"
                                            attrs="{'invisible': ['|',('step', '=', 'delivered'), ('is_refused','=',True)]}"
                                            confirm="Est ce que vous êtes sûr de refuser ce colis ?"
                                    />

                                </tree>
                            </field>
                        </group>
                        <group>
                            <group>
                                <label for="volume"
                                       attrs="{'invisible': [('transport_type', '!=', 'extern')]}"/>
                                <div class="o_row" name="volume"
                                     attrs="{'invisible': [('transport_type', '!=', 'extern')]}">
                                    <field name="volume"
                                           attrs="{'required': [('transport_type', '!=', 'intern')]}"/>
                                    <span>
                                        m³
                                    </span>
                                </div>
                                <label for="weight"
                                       attrs="{'invisible': [('transport_type', '!=', 'extern')]}"/>
                                <div class="o_row" name="weight"
                                     attrs="{'invisible': [('transport_type', '!=', 'extern')]}">
                                    <field name="weight"
                                           attrs="{'required': [('transport_type', '!=', 'intern')]}"/>
                                    <span>
                                        Kg
                                    </span>
                                </div>


                            </group>
                        </group>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="soch_transport_order_tree_view_tt" model="ir.ui.view">
            <field name="name">soch.transport.order.tree</field>
            <field name="model">soch.transport.order</field>
            <field name="arch" type="xml">
                <tree default_order="create_date desc">
                    <field name="create_date" invisible="1"/>
                    <field name="name"/>
                    <field name="date"/>
                    <field name="source_id"/>
                    <field name="destination_id"/>
                    <field name="nbre_colis"/>
                    <field name="create_uid"/>
                    <field name="current_position_id"/>
                    <field name="ot_state"/>
                    <field name="vehicule_id"/>
                    <field name="driver_id"/>
                    <!--                    <field name="filling_rate" widget="progressbar"/>-->

                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="transport_order_action">
            <field name="name">Transport order</field>
            <field name="res_model">soch.transport.order</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="ot_request_report_action">
            <field name="name">OT requests reports</field>
            <field name="res_model">soch.transport.order</field>
            <field name="view_mode">pivot,graph</field>
        </record>

        <record id="soch_transport_order_search_filter" model="ir.ui.view">
            <field name="name">soch.transport.order.search</field>
            <field name="model">soch.transport.order</field>
            <field name="arch" type="xml">
                <search string="Returns">
                    <field name="name"/>
                    <filter domain="[('type_livraison','=',True)]" string="Transport delivery order" name="ot_true"/>
                    <filter domain="[('type_ot','=','collecting')]"
                            string="Collecting Transport order"
                            name="collecting"/>
                    <filter domain="[('type_ot','=','primary_transport')]"
                            string="Primary Transport order"
                            name="primary"/>
                </search>
            </field>
        </record>


        <record model="ir.actions.act_window" id="transport_order_action_collecting">
            <field name="name">OT Collecting</field>
            <field name="res_model">soch.transport.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_type_ot':'collecting'}</field>
            <field name="domain">[('type_ot','=','collecting')]</field>
            <!--            <field name="context">{'search_default_collecting':1}</field>-->
        </record>

        <record model="ir.actions.act_window" id="transport_order_action_primary">
            <field name="name">OT Primary</field>
            <field name="res_model">soch.transport.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_type_ot':'primary_transport', 'default_primaire':True}</field>
            <field name="domain">[('type_ot','=','primary_transport')]</field>
        </record>
        <record model="ir.actions.server" id="update_name_OT">
            <field name="name">Update OT name</field>
            <field name="model_id" ref="model_soch_transport_order"/>
            <field name="state">code</field>
            <!--            <field name="binding_model_id"-->
            <!--                   ref="sochepress_base.model_soch_transport_order"/>-->
            <field name="code">
                records.set_name()
            </field>
        </record>
        <report
            id="report_transport_order_excel"
            string="Export template to TMS"
            model="soch.transport.order"
            report_type="xlsx"
            name="sochepress_base.transport_order_report_xslx"
            file="Import Rendez Vous"/>

        <report
            id="report_customer_excel"
            string="Canevas"
            model="res.partner"
            report_type="xlsx"
            menu="False"
            name="sochepress_base.customer_report"
            file="Canevas"/>

        <report
            id="report_transport_order_exportation_excel"
            string="Export Transport Order"
            model="soch.transport.order"
            report_type="xlsx"
            name="sochepress_base.transport_order_exportation_report_xslx"
            file="Tableau Exportation OT"/>

    </data>
</odoo>
